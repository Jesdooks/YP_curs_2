import sqlite3
import datetime
import os
import sys
from pathlib import Path
import random

# Добавляем корневую директорию в путь для импорта модулей
sys.path.append(str(Path(__file__).parent.parent.parent))
from app.database.db import get_connection, initialize_db

def fill_database():
    # Инициализация базы данных (создание таблиц)
    initialize_db()
    
    conn = get_connection()
    cursor = conn.cursor()
    
    # Очистка таблиц перед заполнением
    cursor.execute("DELETE FROM work_schedules")
    cursor.execute("DELETE FROM raw_materials")
    cursor.execute("DELETE FROM orders")
    cursor.execute("DELETE FROM employees")
    cursor.execute("DELETE FROM suppliers")
    cursor.execute("DELETE FROM trade_points")
    cursor.execute("DELETE FROM delivery_schedules")
    
    # 1. Добавление торговых точек (20 записей)
    trade_points = [
        ("Магазин 'Хлебный №1'", "ул. Ленина, 15", "7700000001", "770000001", "1234567890123", 5000000.0),
        ("Магазин 'Хлебный №2'", "пр. Мира, 25", "7700000002", "770000002", "1234567890124", 6000000.0),
        ("Магазин 'Хлебный №3'", "ул. Гагарина, 10", "7700000003", "770000003", "1234567890125", 4500000.0),
        ("Магазин 'Хлебный №4'", "пр. Победы, 30", "7700000004", "770000004", "1234567890126", 5500000.0),
        ("Магазин 'Хлебный №5'", "ул. Советская, 20", "7700000005", "770000005", "1234567890127", 4800000.0),
        ("Магазин 'Хлебный №6'", "пр. Ленина, 40", "7700000006", "770000006", "1234567890128", 5200000.0),
        ("Магазин 'Хлебный №7'", "ул. Мира, 15", "7700000007", "770000007", "1234567890129", 5100000.0),
        ("Магазин 'Хлебный №8'", "пр. Гагарина, 25", "7700000008", "770000008", "1234567890130", 4900000.0),
        ("Магазин 'Хлебный №9'", "ул. Победы, 10", "7700000009", "770000009", "1234567890131", 5300000.0),
        ("Магазин 'Хлебный №10'", "пр. Советская, 35", "7700000010", "770000010", "1234567890132", 4700000.0),
        ("Магазин 'Хлебный №11'", "ул. Ленина, 50", "7700000011", "770000011", "1234567890133", 5400000.0),
        ("Магазин 'Хлебный №12'", "пр. Мира, 20", "7700000012", "770000012", "1234567890134", 4600000.0),
        ("Магазин 'Хлебный №13'", "ул. Гагарина, 30", "7700000013", "770000013", "1234567890135", 5800000.0),
        ("Магазин 'Хлебный №14'", "пр. Победы, 15", "7700000014", "770000014", "1234567890136", 5100000.0),
        ("Магазин 'Хлебный №15'", "ул. Советская, 40", "7700000015", "770000015", "1234567890137", 4900000.0),
        ("Магазин 'Хлебный №16'", "пр. Ленина, 25", "7700000016", "770000016", "1234567890138", 5200000.0),
        ("Магазин 'Хлебный №17'", "ул. Мира, 35", "7700000017", "770000017", "1234567890139", 4800000.0),
        ("Магазин 'Хлебный №18'", "пр. Гагарина, 20", "7700000018", "770000018", "1234567890140", 5500000.0),
        ("Магазин 'Хлебный №19'", "ул. Победы, 45", "7700000019", "770000019", "1234567890141", 5000000.0),
        ("Магазин 'Хлебный №20'", "пр. Советская, 15", "7700000020", "770000020", "1234567890142", 5300000.0)
    ]
    
    cursor.executemany("""
        INSERT INTO trade_points (name, address, inn, kpp, ogrn, property_value) 
        VALUES (?, ?, ?, ?, ?, ?)
    """, trade_points)
    
    # 2. Добавление поставщиков (20 записей)
    suppliers = [
        ("ООО 'МукаПром'", "Иванов Иван Иванович", "+7(123)456-78-90"),
        ("ЗАО 'СахарИндустрия'", "Петров Петр Петрович", "+7(234)567-89-01"),
        ("ИП Сидоров", "Сидоров Алексей Владимирович", "+7(345)678-90-12"),
        ("ООО 'ДрожжиПлюс'", "Кузнецова Мария Ивановна", "+7(456)789-01-23"),
        ("Агрохолдинг 'Зерно'", "Николаев Сергей Александрович", "+7(567)890-12-34"),
        ("ИП Козлова", "Козлова Елена Петровна", "+7(678)901-23-45"),
        ("ООО 'МолПродукт'", "Смирнов Дмитрий Андреевич", "+7(789)012-34-56"),
        ("ЗАО 'ЯйцоПтица'", "Морозова Анна Сергеевна", "+7(890)123-45-67"),
        ("ООО 'УпаковкаТара'", "Васильев Игорь Викторович", "+7(901)234-56-78"),
        ("ИП Григорьев", "Григорьев Михаил Александрович", "+7(012)345-67-89"),
        ("ООО 'МаслоПродукт'", "Соколова Татьяна Дмитриевна", "+7(123)456-78-91"),
        ("ЗАО 'СпецииПлюс'", "Лебедев Алексей Игоревич", "+7(234)567-89-02"),
        ("ИП Новикова", "Новикова Екатерина Андреевна", "+7(345)678-90-13"),
        ("ООО 'ФруктыОвощи'", "Козловский Михаил Владимирович", "+7(456)789-01-24"),
        ("ЗАО 'ОрехиПлюс'", "Зайцева Марина Сергеевна", "+7(567)890-12-35"),
        ("ИП Волков", "Волков Андрей Николаевич", "+7(678)901-23-46"),
        ("ООО 'СырьеОпт'", "Павлова Ольга Владимировна", "+7(789)012-34-57"),
        ("ЗАО 'ПродуктыПлюс'", "Семенов Денис Сергеевич", "+7(890)123-45-68"),
        ("ИП Федорова", "Федорова Наталья Игоревна", "+7(901)234-56-79"),
        ("ООО 'БакалеяОпт'", "Михайлов Артем Дмитриевич", "+7(012)345-67-90")
    ]
    
    cursor.executemany("INSERT INTO suppliers (name, contact, phone) VALUES (?, ?, ?)", suppliers)
    
    # 3. Добавление сотрудников (20 записей)
    employees = [
        ("Иванов Сергей Петрович", "Пекарь", "+7(111)222-33-44"),
        ("Петрова Анна Ивановна", "Пекарь", "+7(222)333-44-55"),
        ("Сидорова Елена Александровна", "Кондитер", "+7(333)444-55-66"),
        ("Кузнецов Андрей Николаевич", "Кондитер", "+7(444)555-66-77"),
        ("Смирнова Ольга Владимировна", "Технолог", "+7(555)666-77-88"),
        ("Морозов Дмитрий Сергеевич", "Технолог", "+7(666)777-88-99"),
        ("Васильева Наталья Андреевна", "Упаковщик", "+7(777)888-99-00"),
        ("Николаев Игорь Дмитриевич", "Упаковщик", "+7(888)999-00-11"),
        ("Козлов Алексей Петрович", "Грузчик", "+7(999)000-11-22"),
        ("Зайцева Марина Сергеевна", "Менеджер", "+7(000)111-22-33"),
        ("Григорьев Владимир Иванович", "Директор", "+7(111)333-55-77"),
        ("Соколова Татьяна Дмитриевна", "Бухгалтер", "+7(222)444-66-88"),
        ("Лебедев Алексей Игоревич", "Водитель", "+7(333)555-77-99"),
        ("Новикова Екатерина Андреевна", "Администратор", "+7(444)666-88-00"),
        ("Козловский Михаил Владимирович", "Охранник", "+7(555)777-99-11"),
        ("Павлова Светлана Игоревна", "Пекарь", "+7(666)888-00-22"),
        ("Федоров Антон Дмитриевич", "Кондитер", "+7(777)999-11-33"),
        ("Волкова Ирина Александровна", "Технолог", "+7(888)000-22-44"),
        ("Михайлов Денис Сергеевич", "Упаковщик", "+7(999)111-33-55"),
        ("Андреева Юлия Владимировна", "Менеджер", "+7(000)222-44-66")
    ]
    
    cursor.executemany("INSERT INTO employees (name, position, phone) VALUES (?, ?, ?)", employees)
    
    # 4. Добавление заказов (20 записей)
    orders = []
    statuses = ["Новый", "В обработке", "Выполнен", "Отменен"]
    
    for i in range(20):
        trade_point_id = i % 20 + 1  # циклически связываем с торговыми точками
        description = f"Заказ №{i+1} от торговой точки {trade_point_id}"
        # Дата заказа (в течение последних 30 дней)
        order_date = (datetime.datetime.now() - datetime.timedelta(days=i % 30)).strftime("%Y-%m-%d")
        status = statuses[i % 4]
        amount = round(random.uniform(1000, 10000), 2)  # Случайная сумма от 1000 до 10000
        material_costs = round(amount * 0.3, 2)  # 30% от суммы заказа
        labor_costs = round(amount * 0.2, 2)  # 20% от суммы заказа
        operational_costs = round(amount * 0.1, 2)  # 10% от суммы заказа
        
        orders.append((trade_point_id, description, order_date, status, amount, 
                      material_costs, labor_costs, operational_costs))
    
    cursor.executemany("""
        INSERT INTO orders (trade_point_id, description, order_date, status, amount,
                          material_costs, labor_costs, operational_costs) 
        VALUES (?, ?, ?, ?, ?, ?, ?, ?)
    """, orders)
    
    # 5. Добавление сырья (20 записей)
    raw_materials = [
        ("Мука пшеничная", 1, 100.0, "кг", 80.0),
        ("Дрожжи", 1, 5.0, "кг", 200.0),
        ("Соль", 1, 10.0, "кг", 30.0),
        ("Сахар", 1, 20.0, "кг", 100.0),
        ("Яйца", 1, 100.0, "шт", 15.0),
        ("Масло растительное", 1, 20.0, "л", 150.0),
        ("Маргарин", 1, 15.0, "кг", 180.0),
        ("Молоко", 1, 50.0, "л", 120.0),
        ("Ванилин", 1, 0.5, "кг", 2000.0),
        ("Мука пшеничная высший сорт", 1, 1000.0, "кг", 120.0),
        ("Мука ржаная", 1, 500.0, "кг", 90.0),
        ("Сахар", 2, 200.0, "кг", 95.0),
        ("Соль", 2, 50.0, "кг", 25.0),
        ("Дрожжи сухие", 4, 25.0, "кг", 220.0),
        ("Дрожжи прессованные", 4, 15.0, "кг", 180.0),
        ("Масло сливочное", 7, 30.0, "кг", 450.0),
        ("Масло растительное", 7, 50.0, "л", 140.0),
        ("Яйца куриные", 8, 500.0, "шт", 12.0),
        ("Молоко", 7, 100.0, "л", 110.0),
        ("Сметана", 7, 20.0, "кг", 250.0),
        ("Ванилин", 2, 5.0, "кг", 1800.0),
        ("Изюм", 3, 15.0, "кг", 300.0),
        ("Орехи грецкие", 3, 10.0, "кг", 400.0),
        ("Мак", 3, 8.0, "кг", 350.0),
        ("Кунжут", 3, 7.0, "кг", 280.0),
        ("Повидло", 6, 25.0, "кг", 200.0),
        ("Корица", 2, 3.0, "кг", 800.0),
        ("Какао", 2, 10.0, "кг", 600.0),
        ("Кокосовая стружка", 3, 5.0, "кг", 450.0)
    ]
    
    cursor.executemany("INSERT INTO raw_materials (name, supplier_id, quantity, unit, price) VALUES (?, ?, ?, ?, ?)", raw_materials)
    
    # 6. Добавление графиков работы (20 записей)
    work_schedules = []
    days = ["Понедельник", "Вторник", "Среда", "Четверг", "Пятница", "Суббота", "Воскресенье"]
    
    for i in range(20):
        employee_id = i % 20 + 1  # циклически связываем с сотрудниками
        day = days[i % 7]
        start_time = "08:00" if i % 2 == 0 else "20:00"
        end_time = "20:00" if i % 2 == 0 else "08:00"
        
        work_schedules.append((employee_id, day, start_time, end_time))
    
    cursor.executemany("INSERT INTO work_schedules (employee_id, day, start_time, end_time) VALUES (?, ?, ?, ?)", work_schedules)
    
    # 7. Добавление графиков поставок
    delivery_schedules = []
    days = ["Понедельник", "Вторник", "Среда", "Четверг", "Пятница", "Суббота", "Воскресенье"]
    delivery_times = ["06:00", "08:00", "10:00", "12:00", "14:00", "16:00", "18:00"]
    
    for i in range(20):
        trade_point_id = i + 1
        for j in range(7):
            delivery_schedules.append((
                trade_point_id,
                days[j],
                delivery_times[j]
            ))
    
    cursor.executemany(
        "INSERT INTO delivery_schedules (trade_point_id, day, delivery_time) VALUES (?, ?, ?)",
        delivery_schedules
    )
    
    # Сохраняем изменения и закрываем соединение
    conn.commit()
    conn.close()
    
    print("База данных успешно заполнена!")

if __name__ == "__main__":
    fill_database() 